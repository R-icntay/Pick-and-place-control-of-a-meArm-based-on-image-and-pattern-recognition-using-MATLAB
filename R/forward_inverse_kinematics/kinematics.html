<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.230">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Eric Wanjau and Ian Muchiri">
  <title>rstudio::conf 2022: A touch of R in Robotics</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="kinematics_files/libs/clipboard/clipboard.min.js"></script>
  <script src="kinematics_files/libs/quarto-html/quarto.js"></script>
  <script src="kinematics_files/libs/quarto-html/popper.min.js"></script>
  <script src="kinematics_files/libs/quarto-html/tippy.umd.min.js"></script>
  <script src="kinematics_files/libs/quarto-html/anchor.min.js"></script>
  <link href="kinematics_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link id="quarto-text-highlighting-styles" href="kinematics_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="kinematics_files/libs/bootstrap/bootstrap.min.js"></script>
  <link href="kinematics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="kinematics_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#forward-and-inverse-kinematics" id="toc-forward-and-inverse-kinematics" class="nav-link active" data-scroll-target="#forward-and-inverse-kinematics"> <span class="header-section-number">1</span> Forward and Inverse Kinematics</a>
<ul class="collapse">
<li><a href="#forward-kinematics" id="toc-forward-kinematics" class="nav-link" data-scroll-target="#forward-kinematics"> <span class="header-section-number">1.1</span> Forward Kinematics</a></li>
<li><a href="#inverse-kinematics" id="toc-inverse-kinematics" class="nav-link" data-scroll-target="#inverse-kinematics"> <span class="header-section-number">1.2</span> Inverse kinematics</a></li>
</ul></li>
<li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"> <span class="header-section-number">2</span> Summary</a></li>
</ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">


<div class="quarto-title"><div class="quarto-title-block"><div><h1 class="title">rstudio::conf 2022: A touch of R in Robotics</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div></div><div class="quarto-title-meta"><div><div class="quarto-title-meta-heading">Author</div><div class="quarto-title-meta-contents"><div class="quarto-title-authors"><div><div>
<p>Eric Wanjau and Ian Muchiri</p>
</div></div></div></div></div></div></header>

<div class="cell">

</div>
<p>This Notebook contains proposed code and prose for our talk at <a href="https://www.rstudio.com/conference/">rstudio::conf 2022</a></p>
<section id="forward-and-inverse-kinematics" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="forward-and-inverse-kinematics"><span class="header-section-number">1</span> Forward and Inverse Kinematics</h2>
<p>Kinematics is the science of motion that treats the subject without regard to the forces that cause it.</p>
<section id="forward-kinematics" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="forward-kinematics"><span class="header-section-number">1.1</span> Forward Kinematics</h3>
<p>Forward kinematics addresses the problem of computing the <strong>position and orientation of the end effector</strong> relative to the user’s workstation given the joint angles of the manipulator.</p>
<p>The forward kinematics were performed in accordance with the <a href="https://en.wikipedia.org/wiki/Denavit%E2%80%93Hartenberg_parameters">Denavit—Hartenberg (D-H)</a> convention. According to the D-H convention, any robot can be described kinematically by giving the values of four quantities, typically known as the D-H parameters, for each link. The link length <span class="math inline">a</span> and the link twist <span class="math inline">\alpha</span>quantities<em>,</em> describe the link itself and the remaining two; link offset <span class="math inline">d</span> and the joint angle <span class="math inline">θ</span> describe the link’s connection to a neighboring link. The DH parameters of the meArm can be summarized as below:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/MeArm3D.jpg" class="img-fluid figure-img" width="400"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">meArm parallel-link manipulator</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/meArm.png" class="img-fluid figure-img" width="400"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">DH Convention Frame assignment</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<table class="table">
<caption>D-H parameters for meArm</caption>
<thead>
<tr class="header">
<th>Link</th>
<th><span class="math inline">\theta</span></th>
<th><span class="math inline">a(mm)</span></th>
<th><span class="math inline">\alpha</span></th>
<th><span class="math inline">d(mm)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><span class="math inline">\theta_1</span></td>
<td>0</td>
<td>90</td>
<td>55</td>
</tr>
<tr class="even">
<td>2</td>
<td><span class="math inline">\theta_2</span></td>
<td>80</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td><span class="math inline">\theta_3</span></td>
<td>120</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>In this convention, each homogeneous transformation <span class="math inline">A_i</span> is represented as a product of four basic transformations, which evaluates to a 4by4 matrix that is used to transform a point from frame n to n-1.</p>
<p>Considering the three links of the MeArm, the total homogeneous transformation will be a product of the transformations of the three links given as:</p>
<p><span id="eq-transmat"><span class="math display">
A_T = A_1 \times A_2 \times A_3
\qquad(1)</span></span></p>
<p>The final total homogeneous transformation was derived to be:</p>
<p><span id="eq-totaltransmat"><span class="math display">
A_t =\
\begin{bmatrix}
cos(\theta_2 + \theta_3)cos(\theta_1) &amp; -sin(\theta_2 + \theta_3)cos(\theta_1) &amp; sin(\theta_1) &amp; 4\sigma_1cos(\theta_1)
\\cos(\theta_2 + \theta_3)sin(\theta_1) &amp; -sin(\theta_2 + \theta_3)sin(\theta_1) &amp; -cos(\theta_1) &amp; 4\sigma_1sin(\theta_1)
\\
sin(\theta_2 + \theta_3) &amp; cos(\theta_2 + \theta_3) &amp; 0 &amp; 12sin(\theta_2 + \theta_3) + 8sin(\theta_2) - \frac{11}{2}\\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\qquad(2)</span></span></p>
<p>where</p>
<p><span class="math display">
\sigma_1 = 3\ cos(\theta_2 + \theta_3) + 2 \ cos(\theta_2)
</span></p>
<p>The position and orientation of the end effector <span class="math inline">x, y, z</span> of the meArm was consequently obtained from the total homogeneous <span class="math inline">A_t</span>transformation using the upper right 3x1 matrix as:</p>
<p><span id="eq-fkin"><span class="math display">
\begin{bmatrix}
x \\
y \\
z\end{bmatrix} =
\begin{bmatrix}
4\cos(\theta_1) \ (3\ cos(\theta_2 + \theta_3) + 2 \ cos(\theta_2)) \\
4\sin(\theta_1) \ (3\ cos(\theta_2 + \theta_3) + 2 \ cos(\theta_2)) \\
12sin(\theta_2 + \theta_3) + 8sin(\theta_2) - \frac{11}{2}
\end{bmatrix}
\qquad(3)</span></span></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>See <a href="https://github.com/R-icntay/research-papers/blob/main/papers/ENHANCING%20PALLETIZING%20AND%20SHAPE%20DRAWING%20USING%20IMAGE%20PROCESSING%20ON%20PARALLEL%20AND%20SERIAL%20LINK%20MANIPULATORS(v7-Final).pdf">this paper</a> for a thorough derivation of the above.</p>
</div>
</div>
<p>That said, let’s put this into code:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function that calculates forward kinematics</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fkin <span class="ot">&lt;-</span> <span class="cf">function</span>(angles){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to radians</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  angles <span class="ot">=</span> angles <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract angles</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  theta1 <span class="ot">=</span> angles[<span class="dv">1</span>] </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  theta2 <span class="ot">=</span> angles[<span class="dv">2</span>]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  theta3 <span class="ot">=</span> pi <span class="sc">-</span> angles[<span class="dv">3</span>]</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate x, y, z</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">cos</span>(theta1) <span class="sc">*</span>( (<span class="dv">3</span><span class="sc">*</span><span class="fu">cos</span>(theta2 <span class="sc">+</span> theta3)) <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">cos</span>(theta2)))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">sin</span>(theta1) <span class="sc">*</span>( (<span class="dv">3</span><span class="sc">*</span><span class="fu">cos</span>(theta2 <span class="sc">+</span> theta3)) <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">cos</span>(theta2)))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> (<span class="dv">12</span> <span class="sc">*</span> <span class="fu">sin</span>(theta2 <span class="sc">+</span> theta3)) <span class="sc">+</span> (<span class="dv">8</span><span class="sc">*</span><span class="fu">sin</span>(theta2)) <span class="sc">-</span> (<span class="dv">11</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return a tibble</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  fkin <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">orientation =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Multiply by -1 to re-orient y and z</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mistake made during finding DH</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">round</span>(<span class="fu">c</span>(x, y <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>, z <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fkin)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What would be the <span class="math inline">x, y, z</span> coordinates of the end effector when rotation of motors <span class="math inline">1, 2, 3</span> are <span class="math inline">90, 113, 78</span> degrees respectively?</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate forward kinematics</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fkin</span>(<span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">113</span>, <span class="dv">78</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 x 2
  orientation position
  &lt;chr&gt;          &lt;dbl&gt;
1 x                  0
2 y                 13
3 z                  5</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fkin</span>(<span class="fu">c</span>(<span class="dv">42</span>, <span class="dv">110</span>, <span class="dv">114</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 x 2
  orientation position
  &lt;chr&gt;          &lt;dbl&gt;
1 x                -11
2 y                 10
3 z                 -3</code></pre>
</div>
</div>
</section>
<section id="inverse-kinematics" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="inverse-kinematics"><span class="header-section-number">1.2</span> Inverse kinematics</h3>
<p>Inverse kinematics addresses the more difficult converse problem of computing the <strong>set of joint angles</strong> that will place the end effector at a desired position and orientation. It is the computation of the manipulator joint angles given the position and orientation of the end effector.</p>
<p>In solving the inverse kinematics problem, the Geometric approach was used to decompose the spatial geometry into several plane-geometry problems based on the sine and the cosine rules. This was done by considering the trigonometric decomposition of various planes of the manipulator as graphically illustrated below:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="images/base_rotation.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="images/2nd_3rd.png" class="img-fluid" width="446"></p>
</div>
</div>
</div>
<p><span id="eq-theta1"><span class="math display">
\theta_1 = tan^{-1} \frac{y}{x}
\qquad(4)</span></span></p>
<p>With the hypotenuse r, connecting x and y obtained using the Pythagoras theorem as</p>
<p><span class="math display">
r = \sqrt{x^2 + y^2}
</span></p>
<p>The angles <span class="math inline">\theta_2</span> 𝑎𝑛𝑑 <span class="math inline">\theta_3</span> were obtained by considering the plane formed by the second and third links as illustrated:</p>
<p><span id="eq-theta2"><span class="math display">
\theta_2 = \alpha + \beta \\
\theta_2 = tan^{-1} \frac{s}{r} \ + tan^{-1} \frac{l_3sin(\theta_3)}{l_2 + l_3cos(\theta_3)}
\qquad(5)</span></span></p>
<p><span id="eq-theta3"><span class="math display">
\theta_3 = cos^{-1}\frac{x^2 + y^2 +s ^2 - l_2^2 - l_3^2}{2l_2l_3}
\qquad(6)</span></span></p>
<p>Where s is the difference between the distance of the end effector from the base and the offset: <span class="math display">
s = z- d
</span></p>
<p>Again, let’s put the above into code</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ikin <span class="ot">&lt;-</span> <span class="cf">function</span>(coordinates){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract xyz coordinates</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> coordinates[<span class="dv">1</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> coordinates[<span class="dv">2</span>]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> coordinates[<span class="dv">3</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Account for manipulator moving right or left</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&gt;=</span> <span class="dv">0</span>){</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">=</span> <span class="fu">atan</span>(x<span class="sc">/</span>y) <span class="sc">+</span> pi<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">=</span> <span class="fu">atan</span>(y<span class="sc">/</span>x) <span class="sc">%&gt;%</span> <span class="fu">abs</span>()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate theta 3 since its needed in theta 2</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  theta3 <span class="ot">=</span> <span class="fu">acos</span>((x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (z<span class="dv">-5</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">8</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">12</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span><span class="dv">8</span><span class="sc">*</span><span class="dv">12</span>))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 8 and 12 are the dimensions of manipulator arms</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate theta 2</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  theta2 <span class="ot">=</span> <span class="fu">atan</span>((<span class="fl">5.5</span> <span class="sc">-</span> z) <span class="sc">/</span> (<span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)) ) <span class="sc">+</span> <span class="fu">atan</span>((<span class="dv">12</span> <span class="sc">*</span> <span class="fu">sin</span>(theta3)) <span class="sc">/</span> (<span class="dv">8</span> <span class="sc">+</span> <span class="dv">12</span><span class="sc">*</span><span class="fu">cos</span>(theta3)))</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(theta2 <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    theta2 <span class="ot">=</span> pi <span class="sc">-</span> <span class="fu">abs</span>(theta2)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ef_position =</span> <span class="fu">c</span>(x, y, z),</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">motor_angles =</span> (<span class="fu">c</span>(theta1, theta2, pi<span class="sc">-</span>theta3)<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi) <span class="sc">%&gt;%</span> <span class="fu">round</span>()</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tbl)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Theoretically, the results from inverse kinematics and forward kinematics should be in tandem for a given set of inputs. Let’s see whether we can get our previous joint angles from the results of the forward kinematics.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate inverse kinematics</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ikin</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">13</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 x 2
  ef_position motor_angles
        &lt;dbl&gt;        &lt;dbl&gt;
1           0           90
2          13          113
3           5           78</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ikin</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>, <span class="dv">10</span>, <span class="sc">-</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 x 2
  ef_position motor_angles
        &lt;dbl&gt;        &lt;dbl&gt;
1         -11           42
2          10          110
3          -3          114</code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="summary"><span class="header-section-number">2</span> Summary</h2>
<p>From the above examples, the xyz coordinate values obtained from forward kinematics operation produced the same input angles when passed through the inverse kinematics equations. This will be essential for future operations such as validating whether motor angle rotations result in a desired xyz position of the end effector.</p>

<!-- -->

</section>
</main>
<!-- /main column -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb11" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "rstudio::conf 2022: A touch of R in Robotics"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Eric Wanjau and Ian Muchiri"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="an">highlight-style:</span><span class="co"> pygments</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">    geometry: </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">      - top=30mm</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">      - left=30mm</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">  docx: default</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = TRUE, echo=FALSE, message=FALSE, warning=F}</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>This Notebook contains proposed code and prose for our talk at <span class="co">[</span><span class="ot">rstudio::conf 2022</span><span class="co">](https://www.rstudio.com/conference/)</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Forward and Inverse Kinematics</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>Kinematics is the science of motion that treats the subject without regard to the forces that cause it.</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="fu">### Forward Kinematics</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>Forward kinematics addresses the problem of computing the **position and orientation of the end effector** relative to the user's workstation given the joint angles of the manipulator.</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>The forward kinematics were performed in accordance with the <span class="co">[</span><span class="ot">Denavit---Hartenberg (D-H)</span><span class="co">](https://en.wikipedia.org/wiki/Denavit%E2%80%93Hartenberg_parameters)</span> convention.</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>According to the D-H convention, any robot can be described kinematically by giving the values of four quantities, typically known as the D-H parameters, for each link.</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>The link length $a$ and the link twist $\alpha$quantities*,* describe the link itself and the remaining two; link offset $d$ and the joint angle $θ$ describe the link's connection to a neighboring link.</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>The DH parameters of the meArm can be summarized as below:</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>::: {layout="[<span class="co">[</span><span class="ot">1,1</span><span class="co">]</span>]"}</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="al">![meArm parallel-link manipulator](images/MeArm3D.jpg)</span>{width="400"}</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="al">![DH Convention Frame assignment](images/meArm.png)</span>{width="400"}</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>| Link | $\theta$   | $a(mm)$ | $\alpha$ | $d(mm)$ |</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>|------|------------|---------|----------|---------|</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>| 1    | $\theta_1$ | 0       | 90       | 55      |</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>| 2    | $\theta_2$ | 80      | 0        | 0       |</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>| 3    | $\theta_3$ | 120     | 0        | 0       |</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>: D-H parameters for meArm</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>In this convention, each homogeneous transformation $A_i$ is represented as a product of four basic transformations, which evaluates to a 4by4 matrix that is used to transform a point from frame n to n-1.</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>Considering the three links of the MeArm, the total homogeneous transformation will be a product of the transformations of the three links given as:</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>A_T = A_1 \times A_2 \times A_3</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>$$ {#eq-transmat}</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>The final total homogeneous transformation was derived to be:</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>A_t =\ </span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>cos(\theta_2 + \theta_3)cos(\theta_1) &amp; -sin(\theta_2 + \theta_3)cos(\theta_1) &amp; sin(\theta_1) &amp; 4\sigma_1cos(\theta_1)</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span>cos(\theta_2 + \theta_3)sin(\theta_1) &amp; -sin(\theta_2 + \theta_3)sin(\theta_1) &amp; -cos(\theta_1) &amp; 4\sigma_1sin(\theta_1)</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a> <span class="sc">\\</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>sin(\theta_2 + \theta_3) &amp; cos(\theta_2 + \theta_3) &amp; 0 &amp; 12sin(\theta_2 + \theta_3) + 8sin(\theta_2) - \frac{11}{2}<span class="sc">\\</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>0 &amp; 0 &amp; 0 &amp; 1</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>$$ {#eq-totaltransmat}</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>\sigma_1 = 3\ cos(\theta_2 + \theta_3) + 2 \ cos(\theta_2)</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>The position and orientation of the end effector $x, y, z$ of the meArm was consequently obtained from the total homogeneous $A_t$transformation using the upper right 3x1 matrix as:</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>x <span class="sc">\\</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>y <span class="sc">\\</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>z\end{bmatrix} = </span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>4\cos(\theta_1) \ (3\ cos(\theta_2 + \theta_3) + 2 \ cos(\theta_2)) <span class="sc">\\</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>4\sin(\theta_1) \ (3\ cos(\theta_2 + \theta_3) + 2 \ cos(\theta_2)) <span class="sc">\\</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>12sin(\theta_2 + \theta_3) + 8sin(\theta_2) - \frac{11}{2}</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>$$ {#eq-fkin}</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>See <span class="co">[</span><span class="ot">this paper</span><span class="co">]</span>(https://github.com/R-icntay/research-papers/blob/main/papers/ENHANCING%20PALLETIZING%20AND%20SHAPE%20DRAWING%20USING%20IMAGE%20PROCESSING%20ON%20PARALLEL%20AND%20SERIAL%20LINK%20MANIPULATORS(v7-Final).pdf) for a thorough derivation of the above.</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>That said, let's put this into code:</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Function that calculates forward kinematics</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>fkin <span class="ot">&lt;-</span> <span class="cf">function</span>(angles){</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to radians</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>  angles <span class="ot">=</span> angles <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract angles</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>  theta1 <span class="ot">=</span> angles[<span class="dv">1</span>] </span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>  theta2 <span class="ot">=</span> angles[<span class="dv">2</span>]</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>  theta3 <span class="ot">=</span> pi <span class="sc">-</span> angles[<span class="dv">3</span>]</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate x, y, z</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">cos</span>(theta1) <span class="sc">*</span>( (<span class="dv">3</span><span class="sc">*</span><span class="fu">cos</span>(theta2 <span class="sc">+</span> theta3)) <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">cos</span>(theta2)))</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">sin</span>(theta1) <span class="sc">*</span>( (<span class="dv">3</span><span class="sc">*</span><span class="fu">cos</span>(theta2 <span class="sc">+</span> theta3)) <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">cos</span>(theta2)))</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> (<span class="dv">12</span> <span class="sc">*</span> <span class="fu">sin</span>(theta2 <span class="sc">+</span> theta3)) <span class="sc">+</span> (<span class="dv">8</span><span class="sc">*</span><span class="fu">sin</span>(theta2)) <span class="sc">-</span> (<span class="dv">11</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return a tibble</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>  fkin <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">orientation =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Multiply by -1 to re-orient y and z</span></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mistake made during finding DH</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">round</span>(<span class="fu">c</span>(x, y <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>, z <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fkin)</span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>What would be the $x, y, z$ coordinates of the end effector when rotation of motors $1, 2, 3$ are $90, 113, 78$ degrees respectively?</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate forward kinematics</span></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a><span class="fu">fkin</span>(<span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">113</span>, <span class="dv">78</span>))</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a><span class="fu">fkin</span>(<span class="fu">c</span>(<span class="dv">42</span>, <span class="dv">110</span>, <span class="dv">114</span>))</span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inverse kinematics</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>Inverse kinematics addresses the more difficult converse problem of computing the **set of joint angles** that will place the end effector at a desired position and orientation.</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>It is the computation of the manipulator joint angles given the position and orientation of the end effector.</span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>In solving the inverse kinematics problem, the Geometric approach was used to decompose the spatial geometry into several plane-geometry problems based on the sine and the cosine rules.</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>This was done by considering the trigonometric decomposition of various planes of the manipulator as graphically illustrated below:</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>::: {layout="[<span class="co">[</span><span class="ot">1,1</span><span class="co">]</span>]"}</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/base_rotation.png)</span></span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/2nd_3rd.png)</span>{width="446" height="396"}</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>\theta_1 = tan^{-1} \frac{y}{x}</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>$$ {#eq-theta1}</span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>With the hypotenuse r, connecting x and y obtained using the Pythagoras theorem as</span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>r = \sqrt{x^2 + y^2}</span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>The angles $\theta_2$ 𝑎𝑛𝑑 $\theta_3$ were obtained by considering the plane formed by the second and third links as illustrated:</span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>\theta_2 = \alpha + \beta <span class="sc">\\</span></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>\theta_2 = tan^{-1} \frac{s}{r} \ + tan^{-1} \frac{l_3sin(\theta_3)}{l_2 + l_3cos(\theta_3)}</span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>$$ {#eq-theta2}</span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>\theta_3 = cos^{-1}\frac{x^2 + y^2 +s ^2 - l_2^2 - l_3^2}{2l_2l_3}</span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>$$ {#eq-theta3}</span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>Where s is the difference between the distance of the end effector from the base and the offset: $$</span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>s = z- d</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>Again, let's put the above into code</span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>ikin <span class="ot">&lt;-</span> <span class="cf">function</span>(coordinates){</span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract xyz coordinates</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> coordinates[<span class="dv">1</span>]</span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> coordinates[<span class="dv">2</span>]</span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> coordinates[<span class="dv">3</span>]</span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Account for manipulator moving right or left</span></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&gt;=</span> <span class="dv">0</span>){</span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">=</span> <span class="fu">atan</span>(x<span class="sc">/</span>y) <span class="sc">+</span> pi<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">=</span> <span class="fu">atan</span>(y<span class="sc">/</span>x) <span class="sc">%&gt;%</span> <span class="fu">abs</span>()</span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate theta 3 since its needed in theta 2</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>  theta3 <span class="ot">=</span> <span class="fu">acos</span>((x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (z<span class="dv">-5</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">8</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">12</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span><span class="dv">8</span><span class="sc">*</span><span class="dv">12</span>))</span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 8 and 12 are the dimensions of manipulator arms</span></span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate theta 2</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a>  theta2 <span class="ot">=</span> <span class="fu">atan</span>((<span class="fl">5.5</span> <span class="sc">-</span> z) <span class="sc">/</span> (<span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)) ) <span class="sc">+</span> <span class="fu">atan</span>((<span class="dv">12</span> <span class="sc">*</span> <span class="fu">sin</span>(theta3)) <span class="sc">/</span> (<span class="dv">8</span> <span class="sc">+</span> <span class="dv">12</span><span class="sc">*</span><span class="fu">cos</span>(theta3)))</span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(theta2 <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>    theta2 <span class="ot">=</span> pi <span class="sc">-</span> <span class="fu">abs</span>(theta2)</span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">ef_position =</span> <span class="fu">c</span>(x, y, z),</span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a>    <span class="at">motor_angles =</span> (<span class="fu">c</span>(theta1, theta2, pi<span class="sc">-</span>theta3)<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi) <span class="sc">%&gt;%</span> <span class="fu">round</span>()</span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tbl)</span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a>Theoretically, the results from inverse kinematics and forward kinematics should be in tandem for a given set of inputs.</span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>Let's see whether we can get our previous joint angles from the results of the forward kinematics.</span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate inverse kinematics</span></span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a><span class="fu">ikin</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">13</span>, <span class="dv">5</span>))</span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a><span class="fu">ikin</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>, <span class="dv">10</span>, <span class="sc">-</span><span class="dv">3</span>))</span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a>From the above examples, the xyz coordinate values obtained from forward kinematics operation produced the same input angles when passed through the inverse kinematics equations.</span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a>This will be essential for future operations such as validating whether motor angle rotations result in a desired xyz position of the end effector.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->


</body></html>